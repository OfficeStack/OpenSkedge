{% extends 'OpenSkedgeBundle:Dashboard:index.html.twig' %}
{% block title %}{{ app_brand_name() }} - Late and Missed Shifts{% endblock %}
{% block stylesheets %}
<style type="text/css">
.btn-save, .btn-close { display: none; }
</style>
{% endblock %}
{% block javascripts %}
{{ parent() }}
<script type="text/javascript">
    $('.btn-edit').on("click", function () {
        $(this).hide();
        $(this).siblings('.btn-save').show();
        $(this).siblings('.btn-close').show();
        $(this).parent().prev().prev().children('select')[0].disabled = false;
    });
    $('.btn-close').on("click", function () {
        $(this).hide();
        $(this).siblings('.btn-save').hide();
        $(this).siblings('.btn-edit').show();
        $(this).parent().prev().prev().children('select')[0].disabled = true;
    })
</script>
{% endblock %}
{% block modulecontent %}
{% if entities is empty %}
<div class="alert">
    <strong>Sweet!</strong> No late or missed shift records found.
</div>
{% else %}
<table class="table table-hover table-condensed">
    <thead>
        <tr>
            <th>User</th>
            <th>Shift Start</th>
            <th>Arrival Time</th>
            <th>Status</th>
            <th>Reason</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for entity in entities %}
        <tr>
            <form action="{{ path('lateshift_update', {'id': entity.id }) }}" method="post">
                <td><a href="{{ path('user_view', {'id': entity.id }) }}">{{ entity.user.name }}</a></td>
                <td>{% if entity.creationTime %}{{ entity.creationTime|date('Y-m-d H:i:s') }}{% endif %}</td>
                <td class="text-error">{% if entity.arrivalTime %}{{ entity.arrivalTime|date('Y-m-d H:i:s') }}{% else %}<strong>Missed</strong>{% endif %}</td>
                <td>
                    <select name="lateshift[status]" disabled="disabled">
                        <option value="Excused"{% if entity.status == "Excused" %} selected="selected"{% endif %}>Excused</option>
                        <option value="Unknown"{% if entity.status == "Unknown" %} selected="selected"{% endif %}>Unknown</option>
                        <option value="Unexcused"{% if entity.status == "Unexcused" %} selected="selected"{% endif %}>Unexcused</option>
                </td>
                <td>{% if entity.notes %}{{ entity.notes }}{% endif %}</td>
                <td>
                    <button class="btn btn-edit" type="button"><i class="icon-pencil"></i> Edit</button>
                    <button class="btn btn-primary btn-save" type="submit"><i class="icon-ok icon-white"></i> Save</button>
                    <button class="btn btn-close" type="button"><i class="icon-remove"></i></button>
                </td>
                <input type="hidden" name="lateshift[_token]" value="{{ csrf_token('lateshift_update') }}" />
            </form>
        </tr>
    {% endfor %}
    </tbody>
</table>
<div class="pagerfanta">
    {{ pagerfanta(paginator, 'twitter_bootstrap') }}
</div>
{% endif %}
{% endblock %}
